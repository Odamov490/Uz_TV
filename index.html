<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üá∫üáø Shoira TV ‚Äî Live kanallar</title>
  <style>
    :root {
      --bg: #050814;
      --bg-soft: #111727;
      --accent: #1e88e5;
      --accent-soft: #223b6a;
      --text: #e9edf7;
      --muted: #9aa7d6;
      --danger: #ff6b81;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #182338 0, #050814 55%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* ===== App bar ===== */
    header {
      padding: 10px 14px;
      background: rgba(3, 8, 20, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: linear-gradient(135deg, #0f9d58, #1e88e5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
      overflow: hidden;
    }

    /* üëá shoira.png logosi uchun */
    .logo-circle img {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      object-fit: cover;
      display: block;
    }

    header .title-block {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    header .title-block span:nth-child(1) {
      font-size: 15px;
      font-weight: 700;
    }

    header .title-block span:nth-child(2) {
      font-size: 11px;
      color: var(--muted);
    }

    .header-btn {
      border: none;
      outline: none;
      background: var(--accent-soft);
      color: var(--text);
      padding: 6px 10px;
      border-radius: 10px;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .header-btn span {
      font-size: 14px;
    }

    /* ===== Layout ===== */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 8px 10px 10px;
    }

    /* Video container (16:9) */
    .video-card {
      background: var(--bg-soft);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.55);
      position: relative;
    }

    .video-wrapper {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 */
      background: #000;
    }

    video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      background: #000;
    }

    .video-info {
      padding: 8px 11px 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .video-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .live-pill {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 9px;
      background: #b71c1c;
      color: #fff;
    }

    .video-sub {
      font-size: 11px;
      color: var(--muted);
    }

    /* ===== Search + filter ===== */
    .search-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .search-row input,
    .search-row select {
      border-radius: 999px;
      border: none;
      outline: none;
      font-size: 12px;
      padding: 7px 11px;
      background: rgba(7, 13, 30, 0.95);
      color: var(--text);
    }

    .search-row input {
      flex: 1;
    }

    .search-row select {
      min-width: 90px;
    }

    /* ===== Kanal ro'yxati ===== */
    .list-card {
      flex: 1;
      background: rgba(7, 13, 30, 0.92);
      border-radius: 16px;
      padding: 6px 0 2px;
      display: flex;
      flex-direction: column;
      min-height: 180px;
    }

    .list-header {
      padding: 0 12px 6px;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
    }

    .list-header b {
      color: var(--text);
      font-size: 12px;
    }

    .channel-list {
      list-style: none;
      margin: 0;
      padding: 0;
      overflow-y: auto;
      max-height: 320px;
    }

    .channel-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 11px;
      cursor: pointer;
      border-radius: 10px;
      margin: 2px 8px;
      transition: background 0.15s ease;
    }

    .channel-item:hover {
      background: rgba(38, 55, 110, 0.8);
    }

    .channel-item.active {
      background: linear-gradient(90deg, rgba(30, 136, 229, 0.9), rgba(67, 160, 71, 0.9));
    }

    .channel-item img {
      width: 42px;
      height: 26px;
      border-radius: 8px;
      object-fit: cover;
      background: #000;
    }

    .ch-text {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .ch-name {
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .ch-meta {
      font-size: 10px;
      color: var(--muted);
    }

    .fav-btn {
      border-radius: 999px;
      border: none;
      background: rgba(20, 92, 173, 0.7);
      color: gold;
      width: 26px;
      height: 26px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
    }

    .fav-btn.off {
      background: rgba(41, 50, 73, 0.8);
      color: #9fa8da;
    }

    .status-row {
      padding: 3px 12px 8px;
      font-size: 10px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .status-error {
      color: var(--danger);
    }

    /* ===== Katta ekran (plan) ===== */
    @media (min-width: 820px) {
      body {
        padding: 10px 0;
      }
      main {
        max-width: 960px;
        margin: 0 auto;
        flex-direction: row;
      }
      .video-card {
        flex: 2.1;
      }
      .list-card {
        flex: 1.2;
        max-height: calc(100vh - 110px);
      }
      .channel-list {
        max-height: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-circle">
      <!-- shoira.png index.html bilan bir papkada turadi -->
      <img src="shoira.png" alt="Shoira TV">
    </div>
    <div class="title-block">
      <span>Shoira TV</span>
    </div>
    <button id="reloadBtn" class="header-btn">
      <span>‚Üª</span>
      Yangilash
    </button>
  </header>

  <main>
    <!-- Video qismi -->
    <section class="video-card">
      <div class="video-wrapper">
        <video id="video" controls playsinline autoplay></video>
      </div>
      <div class="video-info">
        <div class="video-title">
          <span class="live-pill">LIVE</span>
          <span id="nowTitle">Kanal tanlanmagan</span>
        </div>
        <div class="video-sub" id="nowMeta">Avval ro‚Äòyxatdan kanal tanlang</div>

        <div class="search-row">
          <input id="search" placeholder="Kanal yoki toifa bo‚Äòyicha qidirish‚Ä¶" />
          <select id="filter">
            <option value="all">Barchasi</option>
            <option value="favorites">‚òÖ Sevimlilar</option>
            <option value="news">üì∞ Yangilik</option>
            <option value="entertainment">üé≠ Ko‚Äòngilochar</option>
            <option value="sports">üèÖ Sport</option>
            <option value="music">üéµ Musiqa</option>
            <option value="kids">üßí Bolalar</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Kanal ro'yxati -->
    <section class="list-card">
      <div class="list-header">
        <div>
          <b id="count">0 kanal</b>
        </div>
        <div id="statusText">Yuklanmoqda‚Ä¶</div>
      </div>

      <ul id="channels" class="channel-list"></ul>

      <div class="status-row">
        <span id="err" class="status-error"></span>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    // Elementlar
    const video = document.getElementById('video');
    const nowTitle = document.getElementById('nowTitle');
    const nowMeta = document.getElementById('nowMeta');
    const searchEl = document.getElementById('search');
    const filterEl = document.getElementById('filter');
    const reloadBtn = document.getElementById('reloadBtn');
    const listEl = document.getElementById('channels');
    const countEl = document.getElementById('count');
    const statusText = document.getElementById('statusText');
    const errEl = document.getElementById('err');

    // üá∫üáø O'zbekiston + üåç international kids/animation playlistlar
    const SOURCES = [
      'https://iptv-org.github.io/iptv/countries/uz.m3u',        // Uz kanallar
      'https://iptv-org.github.io/iptv/categories/kids.m3u',     // Kids
      'https://iptv-org.github.io/iptv/categories/animation.m3u' // Multfilm/Anime
    ];

    let ALL = [];
    let hls;
    let currentUrl = null;
    const FKEY = 'uztv_favs';
    const getFavs = () => new Set(JSON.parse(localStorage.getItem(FKEY) || '[]'));
    const setFavs = (s) => localStorage.setItem(FKEY, JSON.stringify([...s]));

    // M3U parser
    function parseM3U(text) {
      const out = [];
      let cur = null;
      for (const raw of text.split('\n')) {
        const line = raw.trim();
        if (line.startsWith('#EXTINF:')) {
          const name = line.split(',').pop().trim();
          const logo = (line.match(/tvg-logo="(.*?)"/) || [])[1] || '';
          const group = (line.match(/group-title="(.*?)"/) || [])[1] || '';
          const country = (line.match(/tvg-country="(.*?)"/) || [])[1] || '';
          cur = { name, logo, group, country };
        } else if (line && !line.startsWith('#') && cur) {
          cur.url = line;
          out.push(cur);
          cur = null;
        }
      }
      return out;
    }

    // Yuklash
    async function loadChannels() {
      statusText.textContent = 'Yuklanmoqda‚Ä¶';
      errEl.textContent = '';
      try {
        ALL = [];
        // bir nechta playlistni ketma-ket yuklaymiz
        for (const url of SOURCES) {
          try {
            const txt = await (await fetch(url)).text();
            ALL = ALL.concat(parseM3U(txt));
          } catch (e) {
            console.error('Manba yuklanmadi:', url, e);
          }
        }

        // faqat HLS va dublikat URL larni olib tashlaymiz
        const seen = new Set();
        ALL = ALL.filter(c => c.url && c.url.endsWith('.m3u8')).filter(c => {
          const key = c.url.trim().toLowerCase();
          if (seen.has(key)) return false;
          seen.add(key);
          return true;
        });

        render();
        statusText.textContent = 'Tayyor';
      } catch (e) {
        console.error(e);
        statusText.textContent = 'Xato';
        errEl.textContent = 'Playlist yuklab bo‚Äòlmadi';
      }
    }

    // Filtr
    function render() {
      const favs = getFavs();
      const q = searchEl.value.trim().toLowerCase();
      const mode = filterEl.value;

      let list = ALL.filter(c => {
        const hay = ((c.name || '') + ' ' + (c.group || '')).toLowerCase();
        if (q && !hay.includes(q)) return false;

        if (mode === 'favorites') return favs.has(c.name);
        if (mode === 'news') return /news|yangilik|inform/i.test(hay);
        if (mode === 'entertainment') return /movie|film|serial|entertain/i.test(hay);
        if (mode === 'sports') return /sport/i.test(hay);
        if (mode === 'music') return /music|muz|musiq/i.test(hay);
        if (mode === 'kids') return /kids|child|bolalar|junior|cartoon|animation/i.test(hay);

        return true;
      });

      // nom bo'yicha sortlab olamiz
      list.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

      countEl.textContent = `${list.length} kanal`;
      listEl.innerHTML = '';

      list.forEach(ch => {
        const li = document.createElement('li');
        li.className = 'channel-item';
        if (ch.url === currentUrl) li.classList.add('active');

        const img = document.createElement('img');
        img.loading = 'lazy';
        img.src = ch.logo || 'https://dummyimage.com/120x72/000/ffffff.png&text=TV';

        const textWrap = document.createElement('div');
        textWrap.className = 'ch-text';

        const nm = document.createElement('div');
        nm.className = 'ch-name';
        nm.textContent = ch.name;

        const meta = document.createElement('div');
        meta.className = 'ch-meta';
        meta.textContent = (ch.group || 'TV') + (ch.country ? ` ¬∑ ${ch.country}` : '');

        textWrap.append(nm, meta);

        const favBtn = document.createElement('button');
        const favSet = getFavs();
        const isFav = favSet.has(ch.name);
        favBtn.className = 'fav-btn ' + (isFav ? '' : 'off');
        favBtn.innerHTML = isFav ? '‚òÖ' : '‚òÜ';
        favBtn.title = 'Sevimlilarga qo‚Äòshish/olib tashlash';
        favBtn.onclick = (e) => {
          e.stopPropagation();
          const s = getFavs();
          if (s.has(ch.name)) s.delete(ch.name); else s.add(ch.name);
          setFavs(s);
          render();
        };

        li.append(img, textWrap, favBtn);
        li.onclick = () => play(ch);
        listEl.appendChild(li);
      });
    }

    function destroyHls() {
      if (hls) {
        hls.destroy();
        hls = null;
      }
    }

    function play(ch) {
      currentUrl = ch.url;
      nowTitle.textContent = ch.name || 'Uz TV';
      nowMeta.textContent = (ch.group || 'TV') + (ch.country ? ` ¬∑ ${ch.country}` : '');
      destroyHls();

      if (Hls.isSupported()) {
        hls = new Hls({ maxBufferLength: 20 });
        hls.loadSource(ch.url);
        hls.attachMedia(video);
        hls.on(Hls.Events.ERROR, (_, data) => {
          if (data.fatal) {
            errEl.textContent = 'Ijro xatosi: ' + data.type;
          }
        });
      } else {
        video.src = ch.url;
      }
      video.play().catch(() => {});
      render(); // active klassni yangilash
    }

    // Hodisalar
    searchEl.addEventListener('input', render);
    filterEl.addEventListener('change', render);
    reloadBtn.addEventListener('click', loadChannels);

    // Start
    loadChannels();
  </script>
</body>
</html>
